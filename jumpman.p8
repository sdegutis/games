pico-8 cartridge // http://www.pico-8.com
version 33
__lua__
-- titlescreen

function _init()
	startgame()
end

-->8
-- game

function startgame()
	_draw = drawgame
	_update = updategame
	
	startx,starty = findstart()
	
	players = {}
	
	makeplayer(0)
end

function drawgame()
	cls(12)
	map()
	
	foreach(players,drawplayer)
end

function updategame()
	foreach(players,updateplayer)
end

function findstart()
	for x=0,15 do
		for y=0,15 do
			if mget(x,y) == 1 then
				mset(x,y,0)
				return x,y
			end
		end
	end
end

-->8
-- players


function makeplayer(n)
	add(players,{
		n=n,
		x=startx*8,
		y=starty*8,
		md=0,
		fd=1,
		vx=0,
		vy=0,
		spd=0.25,
		maxv=2,
	})
end

function drawplayer(p)
	local f = p.fd < 0
	local s = 1
	
	if p.md != 0 then
		s += 1
		if time() % 0.5 < 0.25 then
			s += 1
		end
	end
	
	spr(s,p.x,p.y,1,1,f)
end

function updateplayer(p)
	-- set moving dir
	p.md=0
	if (btn(⬅️, p.n)) p.md = -1
	if (btn(➡️, p.n)) p.md =  1
	
	-- set facing dir (if moving)
	if (p.md != 0) p.fd = p.md
	
	-- adjust velocity
	if p.md != 0 then
		p.vx += p.spd * sgn(p.md)
	elseif p.vx != 0 then
		p.vx -= p.spd * sgn(p.vx)*2
	end
	
	if (p.vx> p.maxv) p.vx= p.maxv
	if (p.vx<-p.maxv) p.vx=-p.maxv
	
	p.x += p.vx
end

__gfx__
00000000000444000004440000044400bbbbbbbb3333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000004f1000004f1000004f100333bb33b3333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000fff00000fff00000fff00333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000002200000f2200000022f00333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000002200000022f0000f22000333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000dd000000dd000000dd000333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000440000014400000044100333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000110000000010000010000333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000004040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001000000000000000005050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404000005050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505000005050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
