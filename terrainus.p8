pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
shapes = {
 {{1,1,0},
  {0,1,1}},
 {{0,1,1},
  {1,1,0}},
 {{0,1,0},
  {1,1,1}},
 {{1,1},
  {1,1}},
 {{1,1,1,1}},
}

function make_block()
	local s_num = flr(rnd(4))+1
	local shape = shapes[
								flr(rnd( #shapes ))+1]
	local new_table = {}
	for row in all(shape) do
		local new_row = {}
		add(new_table, new_row)
		for n in all(row) do
			local new_val = 0
			if (n == 1) new_val = s_num
			add(new_row, new_val)
		end
	end
	return new_table
end

block = {
 x = 0,
 y = 0,
 s = make_block()
}

function _draw()
	cls(13)
	map()
end

function _init()
	t=0
	tick()
end

function _update()
	t += 1
	t %= 10
	if t == 0 then
		tick()
	end
end

function tick()
 -- erase block
	for y = 1,#block.s do
		local row = block.s[y]
		for x = 1,#row do
			local cell = row[x]
			mset(block.x+x-1,
			     block.y+y-1,
			     0)
		end
	end
	
	block.y += 1
	
	local hit = false
	
	for y = 1,#block.s do
		local row = block.s[y]
		for x = 1,#row do
		 if mget(block.x+x-1,
   			     block.y+y-1) != 0
   then
   	hit = true
   	goto outer
   end
		end
	end
::outer::
	
	if hit then
	
  block = {
   x = 0,
   y = 0,
   s = make_block()
  }

		return
	end
	
	for y = 1,#block.s do
		local row = block.s[y]
		for x = 1,#row do
			local cell = row[x]
			mset(block.x+x-1,
			     block.y+y-1,
			     cell)
		end
	end
end

__gfx__
00000000fffffff8aaaaaaa4ccccccc1aaaaaaa30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ffffffe8aaaaaa94cccccc51aaaaaab30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700ffeeee88aa999944cc555511aabbbb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000ffeeee88aa999944cc555511aabbbb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000ffeeee88aa999944cc555511aabbbb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700ffeeee88aa999944cc555511aabbbb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000fe888888a9444444c5111111ab3333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888884444444411111111333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
