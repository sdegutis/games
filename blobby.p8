pico-8 cartridge // http://www.pico-8.com
version 42
__lua__


function _init()
	ents={}

	cx=0
	cy=0

	for y=0,63 do
		for x=0,127 do
			local s = mget(x,y)
			if fget(s, 0) then
				-- solid
				makesolid(s,x*8,y*8)
				mset(x,y,1)
			elseif fget(s, 3) then
				makeplayer(s,x*8,y*8)
				mset(x,y,1)
			end
		end
	end

	movecamera()
end

function _update()
	for e in all(ents) do
		if (e.update) e:update()
	end
end

function _draw()
	cls()
	camera(cx,cy)
	map()
	for e in all(ents) do
		if (e.draw) e:draw()
	end
end

function movecamera()
	cx = mid(0, 128*8-128, player.x+4-64)
	cy = mid(0,  64*8-128, player.y+4-64)
end

function makeplayer(s,x,y)
	player = {
		s=s,d=1,
		x=x,y=y,
		vx=0,vy=0,
		draw=drawplayer,
		update=updateplayer,
	}
	add(ents, player)
end

function makesolid(s,x,y)
	add(ents, {
		s=s,x=x,y=y,
		draw=drawsimple,
	})
end

function drawplayer(p)
	spr(p.s, p.x, p.y, 1, 1, p.d<0)
	-- rect(p.x, p.y, p.x+7,p.y+7,2)
end

function drawsimple(e)
	spr(e.s, e.x, e.y)
end

speed=0.5
maxspeed=3
gravity=0.80
maxgrav=9
jumpspeed=7

function updateplayer(p)
	    if btn(➡️) then p.d= 1 p.vx=min(p.vx+speed,maxspeed)
	elseif btn(⬅️) then p.d=-1 p.vx=max(p.vx-speed,-maxspeed)
	elseif p.vx > speed then p.vx = p.vx - speed
	elseif p.vx < -speed then p.vx = p.vx + speed
	elseif p.vx != 0 then p.vx=0
	end
	if p.vx then
		if trymove(p, 'x', p.vx) then
			movecamera()
		end
	end

	if p.grounded and btn(🅾️) then
		p.vy = -jumpspeed
	else
		p.vy = min(p.vy + gravity, maxgrav)
	end

	if trymove(p, 'y', p.vy) then
		p.grounded=false
		movecamera();
	else
		p.grounded=p.vy>0
		p.vy = 0
	end
end

function trymove(e,d,v)
	local s = sgn(v)
	for i=s,v,s do
		e[d] += s

		for o in all(ents) do
			if o != e and e.x >= o.x - 7
								and e.y >= o.y - 7
								and e.x < o.x + 8
								and e.y < o.y + 8
			then
				e[d] -= s
				return false
			end
		end
	end
	return true
end

__gfx__
000000001111111100bbbb0000000000666666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111110b3333b000000000655555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070011111161b337373b00000000655555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700011111111b330303b00000000655555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700011111111b333333b00000000655555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700111611110bb333b000000000655555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001111111100bbbb0000000000655555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111110990099000000000555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10101010101010101010101010101010101010101010101010101010101010101010401010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010404010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010104010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101040401010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101040101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010104040101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010404010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010401010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101040101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040404040401010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104040
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010404010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040404040101040401010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104040101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010404010101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040401010101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104040101010101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040101010101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010404010101010101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040401010101010101010
40101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010
40401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
40404040101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104010401010101010101010
10401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
40101010404040404040101010101010101010101010101010101010101010101010101010101010101010101010101010104040104010101010101010101010
10401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010404040404040101010101010101040
40101010101010101040404040404010101010101010101010101010101010101010101010101010101010101010104040104010101010101010101010101010
10401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040
10101010101010101010101010101040404010101010101010101010101010101010101010101010101010101040401010101010101010101010101010101010
10401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010101010101010101040
10101010101010101010101010101010101040404010101010101010101010101010101010101010101010404010101010101010101010101010101010101010
10401010101010101010101010101010101010101010101010101010101010101010101010101010101010101040404010101010101010101010101010104040
10101010101010101010101010101010101010101040404010101010101010101010101010101040104040101010101010101010101010101010101010101010
10404010101010101010101010101010101010101010101010101010101010101010101010101010101010104040101010101010101010101010101010404010
10101010101010101010101010101010101010101010104040404040404010101040404040404010101010101010101010101010101010101010101010101010
10104010101010101010101010101010101010101010101010101010101010101010101010101010101040404010101010101010101010101010104040101010
10101010101010101010101010101010101010101010101010101040404040404010101010101010101010101010101010101010101010101010101010101010
10104040101010101010101010101010101010101010101010101010101010101010101010101010104040101010101010101010101010101040401010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101040101010101010101010101010101010101010101010101010101010101010101010104040404010101010101010101010404040404010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101040401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010104010101010101010101010101010101010101010101010101010101010101010101010101010104040404040404010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101040401010104040404040404040404040404040404040404040404040404040404040404040404010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010404040404040401010101010104040404010101010101010101010101010101010101010101010101010101010101010101010101010101010
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
__gff__
0000080001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010104040404040404040404040101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101040101020404040401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101040101010101040401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101040101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0104040404040404040404040404010401010101040101040101040401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010404040404040404040404040404040404040404040404040404040401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010104040404040404040401040404040404040101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010101010101010404040404040404040401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040401010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010101040101040104040401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104010101010101010101010101010101010101010101010101010101010101010101010101
0101010101010101010101010101010101010101010401010101010101010104010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040101010101010101010101010101010101010101010101010101010101010101010101
0101010101040401010101010101010101010104010101010101010101010101010401010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010104040101010101010101010101010101010101010101010101010101010101010101
0101010101010404040404010401040104040101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101040101010101010101010101010101010101010101010101010101010101010101
